
			<!DOCTYPE html>
			<html lang="en">
			<meta charset="utf-8">
			<meta name="viewport" content="width=device-width, initial-scale=1">
			<meta name="color-scheme" content="light dark">
			<link rel="icon" type="image/png" href="data:image/png;base64,">
			<title>Javascript Ray Marcher  v0.9</title>
			<style>
				@media (prefers-color-scheme: dark){
					body {
						background:#000;
						--bg-color: #000;
					}
				}
				body{
					margin:1em auto;
					max-width:40em;
					padding:0 .62em 3.24em;
					font:1.2em/1.62 sans-serif;
					--bg-color: white;
				}
				h1,h2,h3 {
					line-height:1.2
				}
				article h1 {
					margin-left: 0;
					text-align: center;
				}
				.summary {
					text-align: center;
				}
				@media print{
					body{
						max-width:none
					}
				}
				img {
					max-width: 25%;
					height: auto;
					float: left;
					margin: 0 1em 1em 0;
				}
				img.right {
					float: right;
					margin: 0 0 1em 1em;
				}
				article img {
					cursor: pointer;
					transition: opacity 0.2s;
				}
				article img:hover {
					opacity: 0.85;
				}
				.lightbox-overlay {
					display: none;
					position: fixed;
					top: 0;
					left: 0;
					width: 100%;
					height: 100%;
					background: rgba(0, 0, 0, 0.9);
					z-index: 9999;
					justify-content: center;
					align-items: center;
					cursor: pointer;
				}
				.lightbox-overlay.active {
					display: flex;
				}
				.lightbox-overlay img {
					max-width: 90%;
					max-height: 90%;
					object-fit: contain;
					border-radius: 4px;
					box-shadow: 0 0 30px rgba(0,0,0,0.5);
					float: none;
					margin: 0;
					cursor: default;
				}
				.lightbox-close {
					position: absolute;
					top: 20px;
					right: 30px;
					color: white;
					font-size: 40px;
					font-weight: bold;
					cursor: pointer;
				}
				.lightbox-close:hover {
					color: #ccc;
				}
			</style>
			<article>
			<header>

			<h1>Javascript Ray Marcher  v0.9</h1>
			</header>
			<div class="summary">
</div>
<div style="clear:both"></div>
<div style="text-align: center; margin: 2em 0;"><span style="display: inline-block; width: 20%; border-top: 2px solid #333; position: relative;"><span style="position: absolute; top: -0.6em; left: 50%; transform: translateX(-50%); background: var(--bg-color, white); padding: 0 0.5em; font-size: 1.5em;">â—†</span></span></div>
<p>Unfortunately, the code for this version no longer works.  I took a detour to see if I could render models created by other programs.  The answer turned out to be yes, but it takes too much work to tune and maintain.</p>
<p>I used a MD2 converter to take a model of an alien from the free XCOM project, and render it in this raytracer.  The attempt started rather badly.  I tried to use thin triangles to render the alien, much like OpenGL does.  This did not work for several reasons.  Many of the triangles were not properly displayed, because they were too thin and the rays stepped right through them without triggering a &quot;hit&quot; in the raycaster.  I was also not handling the format correctly, so there were many mis-aligned triangles sticking out of the figure.</p>
<div style="clear:both"></div>
<p><img loading="lazy" src="/projects/javascriptraymarcher/9.1.png" alt="Alien model attempt"></p>
<div style="clear:both"></div>
<p>Ignoring all the actual problems, I work on getting the shading correct.  It's still a mess, but now it's a well shaded mess.</p>
<div style="clear:both"></div>
<p><img loading="lazy" src="/projects/javascriptraymarcher/9.2.png" alt="Shading correction"></p>
<div style="clear:both"></div>
<p>I lower the step distance for the raycaster.  This slows the render, but helps the rays to hit more triangles.  It's still not great.</p>
<div style="clear:both"></div>
<p><img loading="lazy" src="/projects/javascriptraymarcher/9.3.png" alt="Lower step distance"></p>
<div style="clear:both"></div>
<p>I correct the file loader.  Now there are no stray triangles, and the legs have appeared!</p>
<p><img loading="lazy" src="/projects/javascriptraymarcher/9.4.png" alt="File loader corrected"></p>
<div style="clear:both"></div>
<p>Upper half in shadow, for no good reason that I can recall.</p>
<div style="clear:both"></div>
<p><img loading="lazy" src="/projects/javascriptraymarcher/9.5.png" alt="Upper half in shadow"></p>
<div style="clear:both"></div>
<p>More shadow, but now I have also changed the triangles into tetrahedrons.  This provides the necessary thickness for the rays to hit the model, and suddenly we have a model with no gaps in it.</p>
<div style="clear:both"></div>
<p><img loading="lazy" src="/projects/javascriptraymarcher/9.6.png" alt="Triangles to tetrahedrons"></p>
<div style="clear:both"></div>
<p>Finally a good render.  No stray shadows, no holes in the model, and no stray triangles.</p>
<div style="clear:both"></div>
<p><img loading="lazy" src="/projects/javascriptraymarcher/9.7.png" alt="Good render, no stray shadows"></p>
<div style="clear:both"></div>
<p>And here's our final model, silhouetted against the moon.  Spooky, no?</p>
<div style="clear:both"></div>
<p><img loading="lazy" src="/projects/javascriptraymarcher/9.8.png" alt="Final model silhouetted against the moon"></p>

			</article>
			<div class="lightbox-overlay" id="lightbox">
				<span class="lightbox-close" id="lightbox-close">&times;</span>
				<img src="" alt="" id="lightbox-img">
			</div>
			<script>
			(function() {
				var overlay = document.getElementById('lightbox');
				var lightboxImg = document.getElementById('lightbox-img');
				var closeBtn = document.getElementById('lightbox-close');
				
				// Add click handler to all images in the article
				document.querySelectorAll('article img').forEach(function(img) {
					img.addEventListener('click', function(e) {
						e.preventDefault();
						lightboxImg.src = this.src;
						lightboxImg.alt = this.alt;
						overlay.classList.add('active');
					});
				});
				
				// Close on overlay click
				overlay.addEventListener('click', function(e) {
					if (e.target === overlay || e.target === closeBtn) {
						overlay.classList.remove('active');
					}
				});
				
				// Close on escape key
				document.addEventListener('keydown', function(e) {
					if (e.key === 'Escape') {
						overlay.classList.remove('active');
					}
				});
			})();
			</script>
			</html>
			